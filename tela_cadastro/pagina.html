<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="css.css">
    <title>Cadastrar-se</title>
</head>
<body>

    <div class="left"></div>
    <div class="right">  
        <div class="cadastrar">
            <div class="logo">
                <td><img src="logo.png"></td>
            </div>
            <div class="card">
                <div class="titulo">
                    <h1><b>Abra Sua Conta!</b></h1><br><br>
                </div>

                <label for="txtCPF">CPF</label>               
                <input id="CPF" type="number" name="Nome"><br>
                <label for="txtNome">Nome</label>
                <input id="name" type="text" name="Nome"><br>
                <div class="calendario">
                    <label for="txtDataNasc">Data Nascimento</label>
                    <input id="dataNasci" type="text" name="Nome"><br>
                </div>
                <label for="txtEmail">E-mail</label>
                <input id="Email" type="text" name="Nome"><br>
                <label for="txtSenha">Senha</label>
                <input id="senha" type="password" name="Nome"><br>
                <label for="txtConfirmar">Confirmar Senha</label>
                <input id="confirmarsenha" type="password" name="password"><br><br><br><br>
                
                
                <div class="btnCadastrar">
                    <input type="Submit"  onclick="abrirCadastro()" value="Cadastrar-se">
                </div>
                <div class="btnVoltar">
                    <input type="Submit" onclick="voltar()" value="Voltar">
                </div>
                
                
            </div>
        </div>
    </div>
<script>
function voltar(){
    var directory=window.location.href;

    directory= directory.replace("/tela_cadastro/pagina.html","/tela_login/login.html");
    window.open(directory);
}

function abrirCadastro(){
var directory=window.location.href;
directory= directory.replace("/tela_cadastro/pagina.html","/tela_login/login.html");

    if(document.getElementById("CPF").value!='' && document.getElementById("name").value!='' && document.getElementById("dataNasci").value!='' && document.getElementById("Email").value!=''&& document.getElementById("senha").value!=''&& document.getElementById("confirmarsenha").value!=''){
            cadastrarUsuario();
            alert('Cadastro ConcluÃ­do com sucesso!')
            window.open(directory);

    } else{
        alert('Dados imcompletos!')
    }
}
function cadastrarUsuario(){
    event.preventDefault()
    let url="http://localhost:8080/api/cadastro-cliente"
    let cpf=document.getElementById("CPF").value;
    let nome=document.getElementById("name").value;
    let email=document.getElementById("Email").value;
    let senha=document.getElementById("senha").value;
    let dataNascimento=document.getElementById("dataNasci").value;
    var myString = dataNascimento;
    var array = new Array();
    array = myString.split('/');

    var dataFormatada = (array[2] + "-" + array[1] + "-" + array[0]);

     body={
    "nome":nome,
    "email":email,
    "password":senha,
    "dataNascimento":dataFormatada,
    "cpf":cpf
    }
    post(url,body);
    let data=get(url);
    console.log(data);
    let usarios=JSON.parse(data);
    usarios.array.forEach(element => {
        console.log("Nome: "+ element.nome);
    });


}
function post(url, body){
    let request= new XMLHttpRequest()
    request.open("POST",url,true)
    request.setRequestHeader('Content-type','application/json')
    request.setRequestHeader('Access-Control-Allow-Origin','*')
    request.setRequestHeader('Access-Control-Allow-Methods','OPTIONS,POST,GET')

    request.send(JSON.stringify(body))
    

   return request.responseText
}
function get(url){
  let request= new XMLHttpRequest();
    request.open("GET",url,true);
    request.setRequestHeader('Content-type','application/json');
    request.setRequestHeader('Access-Control-Allow-Origin','*');
    request.setRequestHeader('Access-Control-Allow-Methods','OPTIONS,POST,GET');

    request.send();
    console.log(request.responseText);
   return request.responseText;
}


</script>
</body>
</html>

